#!/bin/bash

# ==============================================================================
# üöÄ ZENTRIA MANAGER - AUTO INSTALLER (ZERO-TO-HERO)
# ==============================================================================
# Instala√ß√£o completa e automatizada para VPS Ubuntu 20.04+
# Configura SWAP, Docker, Evolution API e Zentria.
# ==============================================================================

# Cores para output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

# Fun√ß√£o para tratamento de erros
error_exit() {
    echo -e "${RED}‚ùå Erro: $1${NC}" >&2
    exit 1
}

# Fun√ß√£o para avisos
warning() {
    echo -e "${YELLOW}‚ö†Ô∏è  $1${NC}"
}

# Fun√ß√£o para sucesso
success() {
    echo -e "${GREEN}‚úÖ $1${NC}"
}

# Fun√ß√£o para info
info() {
    echo -e "${BLUE}‚ÑπÔ∏è  $1${NC}"
}

# Salvar diret√≥rio atual
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"

# Mudar para o diret√≥rio raiz do projeto
cd "$PROJECT_ROOT" || error_exit "N√£o foi poss√≠vel acessar o diret√≥rio raiz do projeto"

echo -e "${BLUE}========================================${NC}"
echo -e "${BLUE}  ZENTRIA MANAGER - AUTO INSTALLER${NC}"
echo -e "${BLUE}========================================${NC}"
echo ""

# ==============================================================================
# [1/9] Atualizando Sistema
# ==============================================================================
echo -e "${BLUE}[1/9] Atualizando Sistema...${NC}"
export DEBIAN_FRONTEND=noninteractive
sudo apt update -qq || error_exit "Falha ao atualizar lista de pacotes"
sudo apt install -y curl git nano unzip ufw || error_exit "Falha ao instalar pacotes b√°sicos"
success "Sistema atualizado"

# ==============================================================================
# [2/9] Configurando SWAP (4GB)
# ==============================================================================
echo -e "${BLUE}[2/9] Configurando SWAP (4GB)...${NC}"
if [ $(swapon --show 2>/dev/null | wc -l) -eq 0 ]; then
    if [ ! -f /swapfile ]; then
        sudo fallocate -l 4G /swapfile || sudo dd if=/dev/zero of=/swapfile bs=1M count=4096
        sudo chmod 600 /swapfile
        sudo mkswap /swapfile
        sudo swapon /swapfile
        if ! grep -q "/swapfile" /etc/fstab; then
            echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab > /dev/null
        fi
        success "SWAP de 4GB configurado"
    else
        info "SWAP j√° existe, pulando configura√ß√£o"
    fi
else
    info "SWAP j√° est√° ativo"
fi

# ==============================================================================
# [3/9] Instalando Docker
# ==============================================================================
echo -e "${BLUE}[3/9] Instalando Docker...${NC}"
if ! command -v docker &> /dev/null; then
    curl -fsSL https://get.docker.com | sh || error_exit "Falha ao instalar Docker"
    sudo usermod -aG docker $USER 2>/dev/null || true
    # Tentar usar docker sem sudo (pode n√£o funcionar at√© logout/login)
    if ! sudo docker ps &> /dev/null; then
        warning "Docker instalado, mas pode ser necess√°rio logout/login para usar sem sudo"
    fi
    success "Docker instalado"
else
    info "Docker j√° est√° instalado"
fi

# Verificar se docker compose est√° dispon√≠vel
if ! command -v docker-compose &> /dev/null && ! docker compose version &> /dev/null; then
    warning "Docker Compose n√£o encontrado, tentando instalar..."
    sudo apt install -y docker-compose-plugin || error_exit "Falha ao instalar Docker Compose"
fi

# ==============================================================================
# [4/9] Instalando Node.js & PM2
# ==============================================================================
echo -e "${BLUE}[4/9] Instalando Node.js & PM2...${NC}"
if ! command -v node &> /dev/null; then
    curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash - || error_exit "Falha ao configurar reposit√≥rio Node.js"
    sudo apt install -y nodejs || error_exit "Falha ao instalar Node.js"
    success "Node.js instalado"
else
    NODE_VERSION=$(node -v)
    info "Node.js j√° est√° instalado: $NODE_VERSION"
fi

if ! command -v pm2 &> /dev/null; then
    sudo npm install -g pm2 serve || error_exit "Falha ao instalar PM2 e serve"
    success "PM2 e serve instalados"
else
    info "PM2 j√° est√° instalado"
fi

# ==============================================================================
# [5/9] Configurando Evolution API
# ==============================================================================
echo -e "${BLUE}[5/9] Configurando Evolution API...${NC}"

# Detectar IP do servidor automaticamente com fallbacks
SERVER_IP=$(hostname -I | awk '{print $1}' 2>/dev/null)
if [ -z "$SERVER_IP" ]; then
    SERVER_IP=$(ip addr show | grep "inet " | grep -v 127.0.0.1 | head -1 | awk '{print $2}' | cut -d'/' -f1 2>/dev/null)
fi
if [ -z "$SERVER_IP" ]; then
    SERVER_IP=$(ifconfig 2>/dev/null | grep "inet " | grep -v 127.0.0.1 | head -1 | awk '{print $2}' 2>/dev/null)
fi
if [ -z "$SERVER_IP" ]; then
    SERVER_IP="localhost"
    warning "N√£o foi poss√≠vel detectar o IP do servidor. Usando 'localhost'."
else
    success "IP do servidor detectado: ${SERVER_IP}"
fi

# Parar containers existentes se houver
if sudo docker ps -a --format '{{.Names}}' | grep -q "evolution_postgres\|evolution_redis\|evolution_api"; then
    info "Parando containers existentes..."
    sudo docker compose down 2>/dev/null || sudo docker-compose down 2>/dev/null || true
    sleep 2
fi

# Criar docker-compose.yml
cat > docker-compose.yml <<EOL
services:
  evolution_api:
    image: evoapicloud/evolution-api:v2.3.4
    container_name: evolution_api
    restart: always
    shm_size: '2gb'
    dns:
      - 8.8.8.8
      - 8.8.4.4
    ports:
      - "8080:8080"
    environment:
      - SERVER_PORT=8080
      - SERVER_URL=http://${SERVER_IP}:8080
      - AUTHENTICATION_API_KEY=B8349283-F143-429D-B6C2-9386E8016558
      - WEBSOCKET_ENABLED=true
      - DATABASE_ENABLED=true
      - DATABASE_PROVIDER=postgresql
      - DATABASE_CONNECTION_URI=postgresql://user:password@evolution_postgres:5432/evolution
      - DATABASE_CLIENT_NAME=evolution_exchange
      - RABBITMQ_ENABLED=false
      - CACHE_REDIS_ENABLED=true
      - CACHE_REDIS_URI=redis://evolution_redis:6379/0
      - DEL_INSTANCE=false
      - STORE_MESSAGES=true
      - STORE_MESSAGE_UP=true
      - STORE_CONTACTS=true
      - STORE_CHATS=true
      - CONFIG_SESSION_PHONE_CLIENT=Zentria
      - CONFIG_SESSION_PHONE_NAME=Chrome
      - CONFIG_SESSION_PHONE_OS=Windows
      - CONFIG_SESSION_PHONE_SYNC_FULL_HISTORY=false
      - BROWSER_ARGS=["--no-sandbox","--disable-setuid-sandbox","--disable-dev-shm-usage","--disable-accelerated-2d-canvas","--no-first-run","--disable-gpu","--disable-software-rasterizer"]
      - CORS_ORIGIN=*
      - CORS_METHODS=POST,GET,PUT,DELETE,OPTIONS
      - CORS_CREDENTIALS=true
    depends_on:
      evolution_postgres:
        condition: service_healthy
      evolution_redis:
        condition: service_started

  evolution_postgres:
    image: postgres:15-alpine
    container_name: evolution_postgres
    restart: always
    environment:
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=evolution
    volumes:
      - evolution_postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U user -d evolution || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s

  evolution_redis:
    image: redis:alpine
    container_name: evolution_redis
    restart: always
    command: ["redis-server", "--appendonly", "yes"]
    volumes:
      - evolution_redis_data:/data

volumes:
  evolution_postgres_data:
  evolution_redis_data:
EOL

# Subir containers
info "Iniciando containers Docker..."
if sudo docker compose up -d 2>/dev/null || sudo docker-compose up -d 2>/dev/null; then
    success "Containers Docker iniciados"
    # Aguardar containers iniciarem
    info "Aguardando containers iniciarem..."
    sleep 5
else
    error_exit "Falha ao iniciar containers Docker"
fi

# ==============================================================================
# [6/9] Instalando PostgreSQL (para backend)
# ==============================================================================
echo -e "${BLUE}[6/9] Instalando PostgreSQL (para backend)...${NC}"
if ! command -v psql &> /dev/null; then
    sudo apt install -y postgresql postgresql-contrib || error_exit "Falha ao instalar PostgreSQL"
    sudo systemctl start postgresql || error_exit "Falha ao iniciar PostgreSQL"
    sudo systemctl enable postgresql || true
    success "PostgreSQL instalado e iniciado"
else
    info "PostgreSQL j√° est√° instalado"
    # Garantir que est√° rodando
    sudo systemctl start postgresql 2>/dev/null || true
fi

# Configurar PostgreSQL na porta alta (54321) para evitar conflitos
info "Configurando PostgreSQL na porta 54321..."
PG_CONF=$(sudo find /etc/postgresql -name postgresql.conf 2>/dev/null | head -1)
if [ -n "$PG_CONF" ]; then
    # Fazer backup
    sudo cp "$PG_CONF" "${PG_CONF}.backup" 2>/dev/null || true
    # Alterar porta para 54321
    if ! grep -q "^port = 54321" "$PG_CONF"; then
        sudo sed -i "s/^#*port = .*/port = 54321/" "$PG_CONF" 2>/dev/null || true
        if ! grep -q "^port = 54321" "$PG_CONF"; then
            echo "port = 54321" | sudo tee -a "$PG_CONF" > /dev/null
        fi
        sudo systemctl restart postgresql
        success "PostgreSQL configurado para usar porta 54321"
    else
        info "PostgreSQL j√° est√° configurado para porta 54321"
    fi
else
    warning "Arquivo de configura√ß√£o do PostgreSQL n√£o encontrado."
    warning "Configure manualmente: sudo nano /etc/postgresql/*/main/postgresql.conf"
fi

# Aguardar PostgreSQL iniciar completamente
info "Aguardando PostgreSQL iniciar..."
for i in {1..30}; do
    if sudo -u postgres PGPORT=54321 psql -c "SELECT 1;" > /dev/null 2>&1; then
        success "PostgreSQL est√° pronto"
        break
    fi
    if [ $i -eq 30 ]; then
        warning "PostgreSQL n√£o respondeu ap√≥s 30 tentativas, continuando mesmo assim..."
    fi
    sleep 1
done

# Configurar banco de dados (usando porta 54321)
info "Configurando banco de dados..."
sudo -u postgres PGPORT=54321 psql -c "CREATE DATABASE zentria;" 2>/dev/null || info "Banco zentria j√° existe"
sudo -u postgres PGPORT=54321 psql -c "CREATE USER zentria_user WITH PASSWORD 'zentria_secure_password_2024';" 2>/dev/null || info "Usu√°rio zentria_user j√° existe"
sudo -u postgres PGPORT=54321 psql -c "GRANT ALL PRIVILEGES ON DATABASE zentria TO zentria_user;" 2>/dev/null || true
sudo -u postgres PGPORT=54321 psql -c "ALTER USER zentria_user CREATEDB;" 2>/dev/null || true
success "Banco de dados configurado"

# ==============================================================================
# [7/9] Configurando Backend API
# ==============================================================================
echo -e "${BLUE}[7/9] Configurando Backend API...${NC}"

# Verificar se o diret√≥rio backend existe
if [ ! -d "backend" ]; then
    warning "Diret√≥rio backend n√£o encontrado. Criando estrutura b√°sica..."
    mkdir -p backend/scripts
fi

cd backend || error_exit "N√£o foi poss√≠vel acessar o diret√≥rio backend"

# Criar package.json se n√£o existir
if [ ! -f "package.json" ]; then
    info "Criando package.json do backend..."
    cat > package.json <<EOL
{
  "name": "zentria-backend",
  "version": "1.0.0",
  "description": "Backend API para Zentria com PostgreSQL",
  "type": "module",
  "main": "server.js",
  "scripts": {
    "dev": "node --watch server.js",
    "start": "node server.js",
    "build": "echo 'Backend n√£o requer build - Node.js puro' && exit 0",
    "migrate": "node scripts/migrate.js",
    "migrate-holidays-cache": "node scripts/add-municipal-holidays-cache.js",
    "migrate-gemini-quota": "node scripts/add-gemini-quota-control.js",
    "migrate-national-holidays": "node scripts/add-national-holidays-table.js",
    "create-admin": "node scripts/create-admin.js",
    "update-user-name": "node scripts/update-user-name.js",
    "validate-users": "node scripts/validate-users.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "pg": "^8.11.3",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "bcryptjs": "^2.4.3",
    "jsonwebtoken": "^9.0.2",
    "express-rate-limit": "^7.1.5"
  }
}
EOL
fi

# Instalar depend√™ncias do backend
info "Instalando depend√™ncias do backend..."
if npm install --silent 2>&1 | grep -i "error\|fatal" > /dev/null; then
    warning "Alguns erros durante instala√ß√£o de depend√™ncias, mas continuando..."
else
    success "Depend√™ncias do backend instaladas"
fi

# Gerar JWT secret
JWT_SECRET=$(openssl rand -hex 32 2>/dev/null || head -c 32 /dev/urandom | base64 | tr -d '\n' || echo "default_secret_key_change_in_production_$(date +%s)")

# Criar arquivo .env do backend
info "Criando arquivo .env do backend..."
cat > .env <<EOL
# Configura√ß√£o do PostgreSQL (porta alta para evitar conflitos)
DATABASE_URL=postgresql://zentria_user:zentria_secure_password_2024@localhost:54321/zentria
DB_HOST=localhost
DB_PORT=54321
DB_NAME=zentria
DB_USER=zentria_user
DB_PASSWORD=zentria_secure_password_2024

# JWT Secret para autentica√ß√£o
JWT_SECRET=${JWT_SECRET}

# Porta do servidor
PORT=3001

# CORS - URLs permitidas
CORS_ORIGIN=http://${SERVER_IP}:5173,http://localhost:5173
EOL

# Verificar se os arquivos do backend existem
if [ ! -f "server.js" ] || [ ! -f "scripts/migrate.js" ]; then
    warning "Arquivos do backend n√£o encontrados no diret√≥rio backend/"
    warning "Certifique-se de que voc√™ fez git clone completo do reposit√≥rio."
    warning "Continuando sem backend... (os dados ser√£o salvos apenas no localStorage)"
    BACKEND_AVAILABLE=false
else
    BACKEND_AVAILABLE=true
    mkdir -p scripts
    
    # Executar migra√ß√£o principal
    info "Executando migra√ß√£o principal do banco de dados..."
    if npm run migrate 2>&1; then
        success "Migra√ß√£o principal conclu√≠da"
        
        # Executar TODAS as migra√ß√µes adicionais automaticamente
        info "Executando migra√ß√µes adicionais do banco de dados..."
        
        # Migra√ß√£o: Cache de feriados municipais
        if [ -f "scripts/add-municipal-holidays-cache.js" ]; then
            npm run migrate-holidays-cache 2>/dev/null || true
        fi
        
        # Migra√ß√£o: Controle de cota do Gemini
        if [ -f "scripts/add-gemini-quota-control.js" ]; then
            npm run migrate-gemini-quota 2>/dev/null || true
        fi
        
        # Migra√ß√£o: Tabela de feriados nacionais
        if [ -f "scripts/add-national-holidays-table.js" ]; then
            npm run migrate-national-holidays 2>/dev/null || true
        fi
        
        # Adicionar campo department_id na tabela users (se n√£o existir)
        if [ -f "scripts/add-department-id-to-users.js" ]; then
            node scripts/add-department-id-to-users.js 2>/dev/null || true
        fi
        
        # Corrigir data_keys de chats (opcional)
        if [ -f "scripts/fix-chat-data-keys.js" ]; then
            node scripts/fix-chat-data-keys.js 2>/dev/null || true
        fi
        
        # Migrar configura√ß√µes para globais (user_id = NULL)
        if [ -f "scripts/migrate-config-to-global.js" ]; then
            node scripts/migrate-config-to-global.js 2>/dev/null || true
        fi
        
        # Limpar chats inv√°lidos (opcional, mas recomendado)
        if [ -f "scripts/clean-invalid-chats.js" ]; then
            node scripts/clean-invalid-chats.js 2>/dev/null || true
        fi
        
        # Criar usu√°rio admin padr√£o (se n√£o existir)
        if [ -f "scripts/create-admin.js" ]; then
            npm run create-admin 2>/dev/null || true
        fi
        
        success "Todas as migra√ß√µes do banco de dados foram executadas"
    else
        warning "Erro na migra√ß√£o principal. Verificando conex√£o com PostgreSQL..."
        BACKEND_AVAILABLE=false
    fi
fi

cd "$PROJECT_ROOT" || error_exit "N√£o foi poss√≠vel retornar ao diret√≥rio raiz"

# ==============================================================================
# [8/9] Configurando Frontend
# ==============================================================================
echo -e "${BLUE}[8/9] Configurando Frontend...${NC}"

# Garantir que estamos no diret√≥rio raiz do projeto
if [ ! -f "package.json" ]; then
    # Tentar encontrar o diret√≥rio do projeto
    if [ -d "Zentria" ] && [ -f "Zentria/package.json" ]; then
        cd Zentria
        PROJECT_ROOT="$(pwd)"
    elif [ -d "zentria" ] && [ -f "zentria/package.json" ]; then
        cd zentria
        PROJECT_ROOT="$(pwd)"
    elif [ -d "ZapFlow" ] && [ -f "ZapFlow/package.json" ]; then
        cd ZapFlow
        PROJECT_ROOT="$(pwd)"
    elif [ -d "zapflow" ] && [ -f "zapflow/package.json" ]; then
        cd zapflow
        PROJECT_ROOT="$(pwd)"
    else
        error_exit "package.json n√£o encontrado. Certifique-se de estar no diret√≥rio raiz do projeto."
    fi
fi

# Verificar se package.json tem o script build
if ! grep -q '"build"' package.json; then
    info "Adicionando script build ao package.json..."
    if grep -q '"scripts"' package.json; then
        # Tentar adicionar build aos scripts
        if command -v jq &> /dev/null; then
            jq '.scripts.build = "vite build"' package.json > package.json.tmp && mv package.json.tmp package.json
        else
            # Fallback: adicionar manualmente
            sed -i '/"scripts"/a\    "build": "vite build",' package.json 2>/dev/null || {
                warning "N√£o foi poss√≠vel adicionar script build automaticamente"
            }
        fi
    fi
fi

# Configurar vari√°vel de ambiente do frontend para usar o backend
if [ "$BACKEND_AVAILABLE" = true ]; then
    if [ ! -f ".env" ]; then
        echo "VITE_API_URL=http://${SERVER_IP}:3001" > .env
        success "Arquivo .env do frontend criado"
    else
        # Adicionar ou atualizar VITE_API_URL no .env existente
        if grep -q "VITE_API_URL" .env; then
            sed -i "s|VITE_API_URL=.*|VITE_API_URL=http://${SERVER_IP}:3001|" .env
        else
            echo "VITE_API_URL=http://${SERVER_IP}:3001" >> .env
        fi
        success "Vari√°vel VITE_API_URL configurada no .env"
    fi
    info "VITE_API_URL=http://${SERVER_IP}:3001"
fi

# Instalar depend√™ncias do frontend
info "Instalando depend√™ncias do frontend..."
if [ -d "node_modules" ]; then
    rm -rf node_modules package-lock.json yarn.lock 2>/dev/null || true
fi

if npm install --silent 2>&1 | grep -i "error\|fatal" > /dev/null; then
    warning "Alguns erros durante instala√ß√£o de depend√™ncias, mas continuando..."
else
    success "Depend√™ncias do frontend instaladas"
fi

# Construir aplica√ß√£o frontend
info "Construindo aplica√ß√£o frontend..."
if npm run build 2>&1; then
    success "Build do frontend conclu√≠do"
else
    warning "Erro ao fazer build do frontend. Verifique os logs acima."
    warning "Continuando mesmo assim..."
fi

# ==============================================================================
# [9/9] Finalizando
# ==============================================================================
echo -e "${BLUE}[9/9] Finalizando...${NC}"

# Iniciar backend com PM2 (se os arquivos existirem e migra√ß√£o foi bem-sucedida)
if [ "$BACKEND_AVAILABLE" = true ] && [ -f "backend/server.js" ]; then
    pm2 delete zapflow-backend 2>/dev/null || true
    cd backend
    if pm2 start server.js --name zapflow-backend --update-env; then
        success "Backend iniciado com PM2"
        
        # Aguardar servidor iniciar
        info "Aguardando servidor backend iniciar..."
        sleep 5
        
        # Testar conectividade da API
        info "Testando conectividade da API backend..."
        API_URL="http://${SERVER_IP}:3001/api/health"
        
        # Tentar conectar at√© 15 vezes (15 segundos)
        API_ACCESSIBLE=false
        for i in {1..15}; do
            if curl -s -f -m 2 "$API_URL" > /dev/null 2>&1; then
                API_ACCESSIBLE=true
                success "API backend est√° acess√≠vel em $API_URL"
                break
            fi
            echo -n "."
            sleep 1
        done
        echo ""
        
        if [ "$API_ACCESSIBLE" = false ]; then
            warning "API backend n√£o est√° respondendo ap√≥s 15 segundos"
            warning "Isso pode ser normal se o servidor ainda est√° inicializando"
        fi
    else
        warning "Falha ao iniciar backend com PM2"
    fi
    cd "$PROJECT_ROOT"
else
    warning "Backend n√£o iniciado (arquivos n√£o encontrados ou erro na migra√ß√£o)"
    warning "Os dados ser√£o salvos apenas no localStorage do navegador."
fi

# Iniciar frontend com PM2
info "Iniciando frontend com PM2..."
pm2 delete zapflow-front 2>/dev/null || true
if [ -d "dist" ]; then
    if pm2 start "serve -s dist -l 5173" --name zapflow-front; then
        success "Frontend iniciado com PM2"
        pm2 save || true
        # Tentar configurar startup autom√°tico
        pm2 startup 2>/dev/null | grep "sudo" | bash 2>/dev/null || true
    else
        warning "Falha ao iniciar frontend com PM2"
    fi
else
    warning "Diret√≥rio dist n√£o encontrado. Frontend n√£o pode ser iniciado."
fi

# Configurar firewall
if command -v ufw &> /dev/null; then
    info "Configurando firewall..."
    echo "y" | sudo ufw allow 8080/tcp > /dev/null 2>&1  # Evolution API
    echo "y" | sudo ufw allow 5173/tcp > /dev/null 2>&1  # Frontend
    echo "y" | sudo ufw allow 3001/tcp > /dev/null 2>&1  # Backend API
    echo "y" | sudo ufw allow 22/tcp > /dev/null 2>&1    # SSH
    echo "y" | sudo ufw allow 80/tcp > /dev/null 2>&1    # HTTP
    echo "y" | sudo ufw --force enable > /dev/null 2>&1 || true
    success "Firewall configurado"
fi

# ==============================================================================
# Resumo Final
# ==============================================================================
echo ""
echo -e "${GREEN}========================================${NC}"
echo -e "${GREEN}  INSTALA√á√ÉO CONCLU√çDA COM SUCESSO!${NC}"
echo -e "${GREEN}========================================${NC}"
echo ""
echo -e "üåê Frontend: ${GREEN}http://${SERVER_IP}:5173${NC}"
echo -e "üîå Evolution API: ${GREEN}http://${SERVER_IP}:8080${NC}"
echo -e "üíæ Backend API: ${GREEN}http://${SERVER_IP}:3001${NC}"
echo ""
echo -e "${BLUE}Credenciais padr√£o do admin:${NC}"
echo -e "   Username: ${GREEN}admin@piekas.com${NC}"
echo -e "   Password: ${GREEN}123${NC}"
echo -e "   ${YELLOW}‚ö†Ô∏è  ALTERE A SENHA EM PRODU√á√ÉO!${NC}"
echo ""
echo -e "${BLUE}Pr√≥ximos passos ap√≥s login:${NC}"
echo -e "   1. Criar departamentos em ${YELLOW}Configura√ß√µes > Departamentos${NC}"
echo -e "   2. Criar usu√°rios e atribuir a departamentos em ${YELLOW}Configura√ß√µes > Usu√°rios${NC}"
echo -e "   3. Configurar Gemini API Key em ${YELLOW}Configura√ß√µes > Integra√ß√£o Google${NC} (opcional)"
echo -e "   4. Configurar Chatbot em ${YELLOW}Configura√ß√µes > Chatbot${NC} (opcional)"
echo ""
echo -e "${BLUE}Comandos √∫teis:${NC}"
echo -e "   ${YELLOW}pm2 status${NC}                    - Ver status de todos os servi√ßos"
echo -e "   ${YELLOW}pm2 logs zapflow-backend${NC}     - Ver logs do backend"
echo -e "   ${YELLOW}pm2 logs zapflow-front${NC}       - Ver logs do frontend"
echo -e "   ${YELLOW}pm2 restart zapflow-backend${NC}  - Reiniciar backend"
echo -e "   ${YELLOW}pm2 restart zapflow-front${NC}    - Reiniciar frontend"
echo ""
echo -e "${BLUE}Testar APIs:${NC}"
echo -e "   ${YELLOW}curl http://${SERVER_IP}:3001/api/health${NC}     - Backend API Health Check"
echo -e "   ${YELLOW}curl http://${SERVER_IP}:8080/instance/fetchInstances${NC} - Evolution API"
echo ""
success "Instala√ß√£o completa! Acesse http://${SERVER_IP}:5173 para come√ßar."
